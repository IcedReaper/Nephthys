// by https://github.com/tomsouthall/Chart.HorizontalBar.js
(function(){"use strict";var t=this,i=t.Chart,e=i.helpers,s={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>'};i.HorizontalRectangle=i.Element.extend({draw:function(){var t=this.ctx,i=this.height/2,e=this.y-i,s=this.y+i,a=this.left-(this.left-this.x),l=this.strokeWidth/2;this.showStroke&&(e+=l,s-=l,a+=l),t.beginPath(),t.fillStyle=this.fillColor,t.strokeStyle=this.strokeColor,t.lineWidth=this.strokeWidth,t.moveTo(this.left,e),t.lineTo(a,e),t.lineTo(a,s),t.lineTo(this.left,s),t.fill(),this.showStroke&&t.stroke()},inRange:function(t,i){return t>=this.left&&t<=this.x&&i>=this.y-this.height/2&&i<=this.y+this.height/2}}),i.Type.extend({name:"HorizontalBar",defaults:s,initialize:function(t){var s=this.options;this.ScaleClass=i.Scale.extend({offsetGridLines:!0,calculateBarX:function(t,i,e){var a=this.calculateBaseWidth(),l=this.calculateX(e)-a/2,h=this.calculateBarWidth(t);return l+h*i+i*s.barDatasetSpacing+h/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*s.barValueSpacing},calculateBarWidth:function(t){var i=this.calculateBaseWidth()-(t-1)*s.barDatasetSpacing;return i/t},calculateBaseHeight:function(){return(this.endPoint-this.startPoint)/this.yLabels.length-2*s.barValueSpacing},calculateBarHeight:function(t){var i=this.calculateBaseHeight()-t*s.barDatasetSpacing;return i/t},calculateXInvertXY:function(t){var i=(this.width-Math.round(this.xScalePaddingLeft)-this.xScalePaddingRight)/(this.max-this.min);return Math.round(this.xScalePaddingLeft)+i*(t-this.min)},calculateYInvertXY:function(t){return t*((this.startPoint-this.endPoint)/this.yLabels.length)},calculateBarY:function(t,i,e){var a=this.calculateBaseHeight(),l=this.endPoint+this.calculateYInvertXY(e)-a/2-5,h=this.calculateBarHeight(t);return t>1&&(l=l+h*(i-1)-i*s.barDatasetSpacing+h/2),l},buildCalculatedLabels:function(){this.calculatedLabels=[];for(var t=e.getDecimalPlaces(this.stepValue),i=0;i<=this.steps;i++)this.calculatedLabels.push(e.template(this.templateString,{value:(this.min+i*this.stepValue).toFixed(t)}))},buildYLabels:function(){this.buildYLabelCounter="undefined"==typeof this.buildYLabelCounter?0:this.buildYLabelCounter+1,this.buildCalculatedLabels(),0===this.buildYLabelCounter&&(this.yLabels=this.xLabels),this.xLabels=this.calculatedLabels,this.yLabelWidth=this.display&&this.showLabels?e.longestText(this.ctx,this.font,this.yLabels):0},calculateX:function(t){var i=(this.xLabelRotation>0,this.width-(this.xScalePaddingLeft+this.xScalePaddingRight)),e=i/(this.steps-(this.offsetGridLines?0:1)),s=e*t+this.xScalePaddingLeft;return this.offsetGridLines&&(s+=e/2),Math.round(s)},draw:function(){var t=this.ctx,i=(this.endPoint-this.startPoint)/this.yLabels.length,s=Math.round(this.xScalePaddingLeft);this.display&&(t.fillStyle=this.textColor,t.font=this.font,e.each(this.yLabels,function(a,l){var h=this.endPoint-i*l,o=Math.round(h),n=this.showHorizontalLines;h-=i/2,t.textAlign="right",t.textBaseline="middle",this.showLabels&&t.fillText(a,s-10,h),0!==l||n||(n=!0),n&&t.beginPath(),l>0?(t.lineWidth=this.gridLineWidth,t.strokeStyle=this.gridLineColor):(t.lineWidth=this.lineWidth,t.strokeStyle=this.lineColor),o+=e.aliasPixel(t.lineWidth),n&&(t.moveTo(s,o),t.lineTo(this.width,o),t.stroke(),t.closePath()),t.lineWidth=this.lineWidth,t.strokeStyle=this.lineColor,t.beginPath(),t.moveTo(s-5,o),t.lineTo(s,o),t.stroke(),t.closePath()},this),e.each(this.xLabels,function(i,s){var a=this.calculateX(1)-this.calculateX(0),l=this.calculateX(s)+e.aliasPixel(this.lineWidth)-a/2,h=this.calculateX(s-(this.offsetGridLines?.5:0))+e.aliasPixel(this.lineWidth),o=this.xLabelRotation>0;t.beginPath(),s>0?(t.lineWidth=this.gridLineWidth,t.strokeStyle=this.gridLineColor):(t.lineWidth=this.lineWidth,t.strokeStyle=this.lineColor),t.moveTo(h,this.endPoint),t.lineTo(h,this.startPoint-3),t.stroke(),t.closePath(),t.lineWidth=this.lineWidth,t.strokeStyle=this.lineColor,t.beginPath(),t.moveTo(h,this.endPoint),t.lineTo(h,this.endPoint+5),t.stroke(),t.closePath(),t.save(),t.translate(l,o?this.endPoint+12:this.endPoint+8),t.rotate(-1*e.radians(this.xLabelRotation)),t.font=this.font,t.textAlign=o?"right":"center",t.textBaseline=o?"middle":"top",t.fillText(i,0,0),t.restore()},this))}}),this.datasets=[],this.options.showTooltips&&e.bindEvents(this,this.options.tooltipEvents,function(t){var i="mouseout"!==t.type?this.getBarsAtEvent(t):[];this.eachBars(function(t){t.restore(["fillColor","strokeColor"])}),e.each(i,function(t){t.fillColor=t.highlightFill,t.strokeColor=t.highlightStroke}),this.showTooltip(i)}),this.BarClass=i.HorizontalRectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx}),e.each(t.datasets,function(i,s){var a={label:i.label||null,fillColor:i.fillColor,strokeColor:i.strokeColor,bars:[]};this.datasets.push(a),e.each(i.data,function(e,s){a.bars.push(new this.BarClass({value:e,label:t.labels[s],datasetLabel:i.label,strokeColor:i.strokeColor,fillColor:i.fillColor,highlightFill:i.highlightFill||i.fillColor,highlightStroke:i.highlightStroke||i.strokeColor}))},this)},this),this.buildScale(t.labels),this.BarClass.prototype.left=Math.round(this.scale.xScalePaddingLeft),this.eachBars(function(t,i,s){e.extend(t,{x:Math.round(this.scale.xScalePaddingLeft),y:this.scale.calculateBarY(this.datasets.length,s,i),height:this.scale.calculateBarHeight(this.datasets.length)}),t.save()},this),this.render()},update:function(){this.scale.update(),e.each(this.activeElements,function(t){t.restore(["fillColor","strokeColor"])}),this.eachBars(function(t){t.save()}),this.render()},eachBars:function(t){e.each(this.datasets,function(i,s){e.each(i.bars,t,this,s)},this)},getBarsAtEvent:function(t){for(var i,s=[],a=e.getRelativePosition(t),l=function(t){s.push(t.bars[i])},h=0;h<this.datasets.length;h++)for(i=0;i<this.datasets[h].bars.length;i++)if(this.datasets[h].bars[i].inRange(a.x,a.y))return e.each(this.datasets,l),s;return s},buildScale:function(t){var i=this,s=function(){var t=[];return i.eachBars(function(i){t.push(i.value)}),t},a={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:t.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(t){var i=e.calculateScaleRange(s(),t,this.fontSize,this.beginAtZero,this.integersOnly);e.extend(this,i)},xLabels:t,font:e.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&e.extend(a,{calculateYRange:e.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new this.ScaleClass(a)},addData:function(t,i){e.each(t,function(t,e){this.datasets[e].bars.push(new this.BarClass({value:t,label:i,x:this.scale.calculateBarX(this.datasets.length,e,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[e].strokeColor,fillColor:this.datasets[e].fillColor}))},this),this.scale.addXLabel(i),this.update()},removeData:function(){this.scale.removeXLabel(),e.each(this.datasets,function(t){t.bars.shift()},this),this.update()},reflow:function(){e.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var t=e.extend({height:this.chart.height,width:this.chart.width});this.scale.update(t)},draw:function(t){var i=t||1;this.clear();this.chart.ctx;this.scale.draw(i),e.each(this.datasets,function(t,s){e.each(t.bars,function(t,e){t.hasValue()&&(t.left=Math.round(this.scale.xScalePaddingLeft),t.transition({x:this.scale.calculateXInvertXY(t.value),y:this.scale.calculateBarY(this.datasets.length,s,e),height:this.scale.calculateBarHeight(this.datasets.length)},i).draw())},this)},this)}})}).call(this);